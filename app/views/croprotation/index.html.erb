<% provide(:title, 'Crop Rotation') %>
<div id="wrapper">

<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>


	<%= render "shared/sidebar"%>

	<div id="page-content-wrapper">

		<div class="content-header">
			<a id="menu-toggle" href="#" class="btn btn-default"><i class="icon-reorder"></i></a>
			<h3>Crop Rotation</h3>

		</div>

		<div class="page-content inset">
			<div class="row">

				<div class="col-md-12">

					<% @fields.each do |field| %>

					<%end%>
					
					
					
<div style='width: 800px;'>
  <div id="one_marker" style='width: 800px; height: 400px;'></div>
</div>
<div id='sidebar_container'>
</div>		
					
					
					
					
					
					

					<!-- <table class="table table-striped table-bordered table-condensed table-hover">
					<thead>
					<tr>

					<th>Land Location</th>
					<!-- <th>2010</th>
					<th>2011</th>
					<th>2012</th> -->
					<!-- <th>2013</th>
					<th style="color:red" >2014 (Predicted)</th>

					</tr>

					</thead>

					<tbody> -->

					<!-- <% @fields.each do |field| %>
					<tr>
					<td><%=field.land_location%></td> -->

					<!-- <%if field.year==2010%>
					<td><%=field.crop_type%></td>
					<%else%>
					<td><i>No Record</i></td>
					<%end%>

					<%if field.year==2011%>
					<td><%=field.crop_type%></td>
					<%else%>
					<td><i>No Record</i></td>
					<%end%>
					-->

					<!-- <%if field.year==2012%>
					<td><%=field.crop_type%></td>
					<%else%>
					<td><i>No Record</i></td>
					<%end%> -->

					<!--

					<%if field.year==2013 && field.year !=2012%>
					<td><%=field.crop_type%></td>
					<%else%>
					<td><i>No Record</i></td>
					<%end%>

					<%if field.crop_type=='Canola' && field.year==2013%>
					<td style="color:red">Pulse(Peas or Lentils)</td>
					<%elsif field.crop_type=='Field Peas' && field.year==2013%>
					<td style="color:red">Cereal(Wheat or Durum)</td>
					<%elsif field.crop_type=='Wheat- Hard Red Spring' && field.year==2013%>
					<td style="color:red">Canola</td>
					<%else%>
					<td style="color:red">No 2013 record!</td>
					<%end%>

					</tr>
					<%end%> -->

					<!-- </tbody>

					</table> -->

				</div>
			</div>
		</div>
	</div>

<script type="text/javascript">
function createSidebarLi(json){
  return ("<li><a>" + json.name + "</a></li>");
};

function bindLiToMarker($li, marker){
  $li.on('click', function(){
    handler.getMap().setZoom(14);
    marker.setMap(handler.getMap()); //because clusterer removes map property from marker
    marker.panTo();
    google.maps.event.trigger(marker.getServiceObject(), 'click');
  })
};

function createSidebar(json_array){
  _.each(json_array, function(json){
    var $li = $( createSidebarLi(json) );
    $li.appendTo('#sidebar_container');
    bindLiToMarker($li, json.marker);
  });
};

handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'sidebar_builder'}}, function(){
  var json_array = [
    { lat: 40, lng: -80, name: 'Foo', infowindow: "I'm Foo" },
    { lat: 45, lng: -90, name: 'Bar', infowindow: "I'm Bar" },
    { lat: 50, lng: -85, name: 'Baz', infowindow: "I'm Baz" }
  ];

  var markers = handler.addMarkers(json_array);

  _.each(json_array, function(json, index){
    json.marker = markers[index];
  });

  createSidebar(json_array);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});
google.maps.event.addDomListener(window, "load", initialize);
</script>